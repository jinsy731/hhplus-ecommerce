# k6 쿠폰 API 성능 테스트

이 디렉토리에는 이커머스 서비스의 쿠폰 API에 대한 성능 테스트 스크립트가 포함되어 있습니다.

## 테스트 시나리오

성능 테스트는 다음 세 가지 주요 시나리오로 구성되어 있습니다:

1. **쿠폰 조회 테스트** (`coupon_retrieve_test.js`)
   - 사용자의 보유 쿠폰 목록 조회 요청을 시뮬레이션
   - 다양한 페이지네이션 옵션을 사용해 다수의 사용자가 동시에 조회하는 상황 테스트
   - 다양한 정렬 옵션과 페이지 크기에 따른 응답 속도 비교

2. **쿠폰 발급 테스트** (`coupon_issue_test.js`)
   - 사용자의 쿠폰 발급 요청을 시뮬레이션
   - 다수의 사용자가 동시에 쿠폰을 발급받는 상황 테스트
   - 반복 발급 시도를 통한 중복 발급 오류 처리 테스트

3. **통합 시나리오 테스트** (`coupon_test_suite.js`)
   - 세 가지 서로 다른 시나리오를 병렬로 실행:
     - 일반적인 조회 위주 시나리오 (읽기 작업)
     - 발급 위주 시나리오 (쓰기 작업)
     - 고부하 혼합 시나리오 (읽기/쓰기 혼합)
   - 각 시나리오별 분리된 부하 프로필 적용
   - 실제 사용 패턴을 보다 현실적으로 시뮬레이션

## 모니터링 지표

각 테스트는 다음 핵심 지표를 측정하고 보고합니다:

- **P95 쿠폰 조회 응답 시간**: 95%의 쿠폰 목록 조회 요청이 이 시간 이내에 완료됨
- **P95 쿠폰 발급 응답 시간**: 95%의 쿠폰 발급 요청이 이 시간 이내에 완료됨
- **API 호출 에러율**: 실패한 API 요청의 비율
- **쿠폰 발급 오류 수**: 쿠폰 발급 중 발생한 오류 횟수 (중복 발급 포함)
- **HTTP 요청 지속 시간**: 모든 HTTP 요청에 대한 응답 시간 통계

## 테스트 실행 방법

### 전체 테스트 스위트 실행:

```bash
bash run-coupon-tests.sh
```

### 개별 테스트 실행:

```bash
# 쿠폰 조회 테스트
k6 run coupon_retrieve_test.js

# 쿠폰 발급 테스트
k6 run coupon_issue_test.js

# 통합 시나리오 테스트
k6 run coupon_test_suite.js
```

## 테스트 결과 해석

테스트 결과는 콘솔 출력으로 확인할 수 있으며, 필요에 따라 JSON 또는 CSV 형식으로 저장할 수 있습니다. 다음 지표를 중점적으로 확인하세요:

- **쿠폰 조회 vs 발급 성능**: 읽기 작업과 쓰기 작업 간의 성능 차이를 비교하여 시스템의 IO 처리 능력 평가
- **P95 응답 시간**: 대부분의 요청이 처리되는 시간으로, 사용자 경험에 직접적인 영향을 미침
- **에러율 증가**: 부하가 증가함에 따라 에러율이 급격히 증가하는 지점이 시스템의 한계 용량을 나타냄
- **동시 사용자 증가에 따른 영향**: 동시 접속자 수 증가에 따른 시스템 성능 변화 파악

## 테스트 커스터마이징

각 스크립트 내에서 다음 파라미터를 조정하여 테스트를 커스터마이징할 수 있습니다:

- VU(Virtual User) 수 및 증가 패턴
- 테스트 단계 및 기간
- 사용자 ID 범위
- 테스트할 쿠폰 ID 목록
- 페이지네이션 및 정렬 옵션
- 임계값(thresholds) 설정
- 요청 간 대기 시간

## 주의 사항

- 테스트는 로컬 개발 환경이 아닌 테스트 환경에서 실행하는 것이 좋습니다.
- 실제 프로덕션 환경에 대한 테스트는 충분한 주의를 기울여 진행해야 합니다.
- 테스트 전에 적절한 테스트 데이터(사용자 계정, 쿠폰 등)가 준비되어 있어야 합니다.
- 테스트 중 발급된 쿠폰은 실제 사용자에게 부여될 수 있으므로, 테스트 환경에서만 실행하세요.
- 중복 발급 테스트는 실제 쿠폰 수량에 영향을 미치지 않지만, 서버 부하를 발생시킵니다.
